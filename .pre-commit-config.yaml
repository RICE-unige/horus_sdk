# Pre-commit configuration for HORUS SDK
# This runs the same checks as CI/CD locally before commits

repos:
  # Basic file checks (exclude generated files)
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.4.0
    hooks:
      - id: trailing-whitespace
        exclude: '.*\.(md|rst)$|^horus_ros2_ws/(build|install|log)/'
      - id: end-of-file-fixer
        exclude: '^horus_ros2_ws/(build|install|log)/'
      - id: check-yaml
        exclude: '^horus_ros2_ws/(build|install|log)/'
      - id: check-json
        exclude: '^horus_ros2_ws/(build|install|log)/'
      - id: check-merge-conflict
      - id: check-added-large-files
        args: ['--maxkb=1000']

  # Python formatting and linting
  - repo: https://github.com/psf/black
    rev: 23.3.0
    hooks:
      - id: black
        language_version: python3
        files: \.(py)$

  - repo: https://github.com/pycqa/isort
    rev: 5.12.0
    hooks:
      - id: isort
        args: ["--profile", "black"]
        files: \.(py)$

  - repo: https://github.com/pycqa/flake8
    rev: 6.0.0
    hooks:
      - id: flake8
        args: ['--max-line-length=99', '--extend-ignore=E203,W503']
        files: \.(py)$

  # MyPy type checking
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.3.0
    hooks:
      - id: mypy
        files: ^python/
        args: [--ignore-missing-imports, --no-strict-optional]
        additional_dependencies: [types-requests]

  # C++ formatting and linting (exclude generated files)
  - repo: https://github.com/pre-commit/mirrors-clang-format
    rev: v16.0.6
    hooks:
      - id: clang-format
        files: \.(cpp|hpp|c|h)$
        exclude: '^horus_ros2_ws/(build|install|log)/'
        args: ['-style=Google']

  # ROS2 specific checks (exclude generated files)
  - repo: local
    hooks:
      # Build check (most important - ensures code compiles)
      - id: colcon-build
        name: colcon-build
        entry: bash -c 'cd horus_ros2_ws && source /opt/ros/humble/setup.bash && colcon build --cmake-args -DCMAKE_BUILD_TYPE=Release'
        language: system
        files: ^horus_ros2_ws/src/.*\.(cpp|hpp|py|xml|txt)$
        pass_filenames: false

      # C++ linting with cpplint (source files only)
      - id: cpplint-check
        name: cpplint-check
        entry: bash -c 'cd horus_ros2_ws && find src -name "*.cpp" -o -name "*.hpp" | xargs cpplint --filter=-build/c++11,-whitespace/braces,-readability/braces'
        language: system
        files: ^horus_ros2_ws/src/.*\.(cpp|hpp)$
        pass_filenames: false
